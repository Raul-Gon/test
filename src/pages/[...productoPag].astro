---
import BaseLayouts from "../layouts/BaseLayouts.astro";
import ProductoImagen from "../components/ProductoImagen.astro";
import ProductoCaracteris from "../components/ProductoCaracteris.astro";
import ProductoEscaparate from "../components/ProductoEscaparate.astro";

import { customSlugify } from '../utils/mySlugify';

export async function getStaticPaths() {
  const productos = `query {
    Favoriteproducts {
        model
        brand
        price
        description
        productimage {
        url
        }
    }
  }`;

  const response = await fetch("https://graphql.apirocket.io", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "Authorization": "Bearer J1dxg1LVe89lwSOh3Svf2eAL8L8ZH3eXX7MasOLVTpFZo1tMUWF01VkmfqlSFmd-",
    },
    body: JSON.stringify({ query: productos }),
  });

  const data = await response.json();
  const productosData = data.data?.Favoriteproducts;

  console.log(productosData);

  // Generar rutas con marca y modelo "slugificados"
  return productosData.map((producto) => {
    return {
      params: {
        productoPag: `/${customSlugify(producto.brand)}/${customSlugify(producto.model)}`,
      },
      props: { product: producto },
    };
  });
}

const { productoPag, product } = Astro.props;
---

<BaseLayouts titulo= {product.model} descripcion= {product.descripcion}>
	<h1 class="hidden">{product.model}</h1>
	
	<main>
		<section class="max-w-[1200px] mx-6 mt-10 xl:mx-auto">
			<div class="static w-full flex flex-col md:flex md:flex-row gap-4 lg:gap-0">    
				<ProductoImagen />
				<ProductoCaracteris />
			</div>						
		</section>
		<section class="overflow-hidden">
			<div class="max-w-[1200px] mx-6 mt-10 xl:mx-auto">
				<ProductoEscaparate />
				<ProductoEscaparate />
			</div>
		</section>
	</main>
</BaseLayouts>